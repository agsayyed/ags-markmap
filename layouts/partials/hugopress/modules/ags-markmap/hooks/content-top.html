{{- /* Injects Markmap at content-top when ags_markmap is enabled */ -}} 
{{- if .Page.Params.ags_markmap -}}
  <script>console.log("[ags-markmap] ags_markmap is enabled in front matter");</script>

  <div id="ags-markmap-container" class="ags-markmap-container"></div>

  {{- with resources.Get "hb/modules/ags-markmap/vendor/d3.min.js" -}}
    {{- $d3 := . | resources.Minify | resources.Fingerprint -}}
    <script src="{{ $d3.RelPermalink }}" integrity="{{ $d3.Data.Integrity }}" defer onerror="console.error('[ags-markmap] Failed to load d3.min.js')"></script>
  {{- else -}}
    <script>console.error('[ags-markmap] d3.min.js not found in resources');</script>
  {{- end -}}

  {{- with resources.Get "hb/modules/ags-markmap/vendor/markmap-view.min.js" -}}
    {{- $mm := . | resources.Minify | resources.Fingerprint -}}
    <script src="{{ $mm.RelPermalink }}" integrity="{{ $mm.Data.Integrity }}" defer onerror="console.error('[ags-markmap] Failed to load markmap-view.min.js')"></script>
  {{- else -}}
    <script>console.error('[ags-markmap] markmap-view.min.js not found in resources');</script>
  {{- end -}}

  {{- with resources.Get "hb/modules/ags-markmap/js/index.js" -}}
    {{- $js := . | resources.Minify | resources.Fingerprint -}}
    <script src="{{ $js.RelPermalink }}" integrity="{{ $js.Data.Integrity }}" defer onerror="console.error('[ags-markmap] Failed to load index.js')"></script>
    <script>
      if (!document.body.dataset.agsMarkmap) {
        document.body.dataset.agsMarkmap = 'true';
        console.log('[ags-markmap] Markmap initialization flag set.');
      } else {
        console.warn('[ags-markmap] Markmap already initialized on this page.');
      }
    </script>
  {{- else -}}
    <script>console.error('[ags-markmap] index.js not found in resources');</script>
  {{- end -}}
{{- else -}}
  <script>console.log("[ags-markmap] ags_markmap is NOT enabled on this page");</script>
{{- end -}}
